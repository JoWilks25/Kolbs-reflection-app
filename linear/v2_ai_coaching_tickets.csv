Title,Description,EstimateHours,Priority
v2 Phase 1: DB Migration & Practice Area Types,"**Goal**
Migrate the database schema from v1 to v2 to support coaching tones, AI metrics, and Practice Area types. Update Practice Area creation/editing UI to include type selection.

## Implementation Overview
- Run v2 migration: add `type` to `practiceareas`, rename `format` ‚Üí `coachingtone` in `reflections`, add AI metric columns
- Migrate existing v1 data: set default `type = 'solo_skill'`, map old formats to coaching tones, set `aiassisted = 0`
- Update PracticeAreaModal to include type dropdown with descriptions
- Display type badges on HomeScreen Practice Area list

## Implementation Steps

### 1. Database Migration (v2.0)
- In `db/migrations.ts`, add v2 migration:
  - Add `type TEXT NOT NULL DEFAULT 'solo_skill'` to `practiceareas` table
  - Create new `reflections_v2` table with:
    - `coachingtone INTEGER NOT NULL` (renamed from `format`)
    - `aiassisted INTEGER NOT NULL DEFAULT 0` (0=off, 1=on)
    - `aiplaceholdersshown INTEGER DEFAULT 0`
    - `aifollowupsshown INTEGER DEFAULT 0`
    - `aifollowupsanswered INTEGER DEFAULT 0`
  - Migrate data from `reflections` to `reflections_v2`:
    - Map `format` ‚Üí `coachingtone` (1‚Üí1, 2‚Üí2, 3‚Üí3)
    - Set `aiassisted = 0` for all existing reflections
    - Set all AI metrics to 0
  - Drop old `reflections` table, rename `reflections_v2` ‚Üí `reflections`
  - Recreate indexes including new `idx_reflections_aiassisted`

### 2. Update Practice Area Types
- Define types in `utils/constants.ts`:
  ```typescript
  export type PracticeAreaType = 'solo_skill' | 'performance' | 'interpersonal' | 'creative';

  export const PRACTICE_AREA_TYPES = [
    { value: 'solo_skill', label: 'Solo Skill', description: 'Technical practice, measurable progress' },
    { value: 'performance', label: 'Performance', description: 'Execution under pressure, audience awareness' },
    { value: 'interpersonal', label: 'Interpersonal', description: 'Communication, emotional dynamics' },
    { value: 'creative', label: 'Creative', description: 'Exploration, experimentation, non-linear discovery' },
  ];
  ```

### 3. Update PracticeAreaModal
- Add type dropdown to create/edit modal:
  - Use React Native Picker or custom dropdown
  - Show type label + description for each option
  - Default to 'solo_skill'
  - Help text: ""This helps the AI coach ask more relevant follow-up questions.""
- Update `handleCreate` to include `type` in INSERT
- Update `handleEdit` to allow changing type for existing Practice Areas:
  - Pre-select current type in dropdown
  - Update `UPDATE` query to include `type` field
  - Ensure type change doesn't break existing sessions/reflections
- Update queries to fetch/display `type`

### 4. Display Type Badges on HomeScreen
- For each Practice Area in the FlatList, show a small type badge:
  - ""Solo"" / ""Performance"" / ""Interpersonal"" / ""Creative""
  - Use distinct colors or icons per type
- Position badge near Practice Area name

### 5. Update Zustand Types
- In `stores/appStore.ts`, update types:
  ```typescript
  export type CoachingTone = 1 | 2 | 3;
  export type PracticeAreaType = 'solo_skill' | 'performance' | 'interpersonal' | 'creative';

  // Update reflectionDraft
  reflectionDraft: {
    coachingTone: CoachingTone | null; // RENAMED from format
    aiAssisted: boolean; // NEW
    step2: string;
    step3: string;
    step4: string;
    aiPlaceholdersShown: number; // NEW
    aiFollowupsShown: number; // NEW
    aiFollowupsAnswered: number; // NEW
    feedbackRating: number | null;
    feedbackNote: string;
  };
  ```

## Files Created / Modified
- **Modified:**
  - `db/migrations.ts` ‚Äì add v2 migration
  - `db/schema.ts` ‚Äì update schema definitions
  - `utils/constants.ts` ‚Äì add PRACTICE_AREA_TYPES
  - `utils/types.ts` ‚Äì update PracticeAreaType, CoachingTone
  - `stores/appStore.ts` ‚Äì update reflectionDraft shape
  - `components/PracticeAreaModal.tsx` ‚Äì add type dropdown
  - `screens/HomeScreen.tsx` ‚Äì display type badges

## Acceptance Criteria
‚úì v2 migration runs successfully on app launch
‚úì Existing v1 Practice Areas have `type = 'solo_skill'` after migration
‚úì Existing v1 reflections have `coachingtone` matching old `format` values (1/2/3)
‚úì All existing reflections have `aiassisted = 0` and AI metrics = 0
‚úì New Practice Areas can be created with type selection dropdown
‚úì Type badges display on HomeScreen for all Practice Areas
‚úì No crashes or data loss during migration
‚úì Can edit existing Practice Area to change type

## Estimate
**4 hours**
",4,High
v2 Phase 2: AI Service Infrastructure & Capability Detection,"**Goal**
Build the AI service layer using react-native-ai/apple for on-device LLM inference, with graceful degradation for unsupported devices.

## Implementation Overview
- Integrate `react-native-ai` and `@react-native-ai/apple` packages
- Build `aiService.ts` for AI capability detection and generation functions
- Build `promptService.ts` for tone-specific system prompts and Practice Area type modifiers
- Create `useAICoaching` React hook for components
- Add AI availability state to Zustand
- Detect Apple Intelligence on app launch, hide AI features when unavailable

## Implementation Steps

### 1. Install Dependencies
- Add to package.json:
  ```json
  ""react-native-ai"": ""^0.x.x"",
  ""@react-native-ai/apple"": ""^0.x.x""
  ```
- Follow react-native-ai setup for Expo (may require expo-dev-client)

### 2. Build AI Service (services/aiService.ts)
```typescript
import { createApple } from '@react-native-ai/apple';
import { Platform } from 'react-native';

export interface AIContext {
  practiceAreaName: string;
  practiceAreaType: PracticeAreaType;
  sessionIntent: string;
  previousStep4Answer: string | null;
  coachingTone: CoachingTone;
  currentStepAnswers?: {
    step2?: string;
    step3?: string;
  };
}

export const checkAIAvailability = async (): Promise<boolean> => {
  // Check iOS version (must be >= 26)
  const iosVersion = parseInt(Platform.Version as string, 10);
  if (iosVersion < 26) return false;

  // Check Apple Intelligence availability
  try {
    const apple = createApple();
    const isAvailable = await apple.isAvailable();
    return isAvailable;
  } catch (error) {
    console.warn('AI availability check failed', error);
    return false;
  }
};

export const generatePlaceholder = async (
  context: AIContext,
  step: 2 | 3 | 4
): Promise<string | null> => {
  const apple = createApple();
  const prompt = buildPlaceholderPrompt(context, step); // from promptService

  try {
    const startTime = Date.now();
    const response = await apple.generate({
      prompt,
      maxTokens: 50,
      temperature: 0.7,
    });
    const latency = Date.now() - startTime;
    if (latency > 2000) {
      console.warn(\`AI placeholder latency exceeded target: \${latency}ms\`);
    }
    return response.text;
  } catch (error) {
    console.error('Placeholder generation failed', error);
    return null;
  }
};

export const generateFollowup = async (
  context: AIContext,
  step: 2 | 3 | 4,
  userAnswer: string
): Promise<string | null> => {
  // Only generate follow-up if answer is brief
  if (userAnswer.length > 50) return null;

  const apple = createApple();
  const prompt = buildFollowupPrompt(context, step, userAnswer);

  try {
    const startTime = Date.now();
    const response = await apple.generate({
      prompt,
      maxTokens: 100,
      temperature: 0.8,
    });
    const latency = Date.now() - startTime;
    if (latency > 2000) {
      console.warn(\`AI follow-up latency exceeded target: \${latency}ms\`);
    }
    return response.text;
  } catch (error) {
    console.error('Follow-up generation failed', error);
    return null;
  }
};
```

### 3. Build Prompt Service (services/promptService.ts)
- Define tone-specific system prompts for Facilitative/Socratic/Supportive
- Define Practice Area type modifiers (solo_skill, performance, interpersonal, creative)
- Implement `buildPlaceholderPrompt(context, step)`:
  - Combine tone prompt + type modifier + context (PA name, intent, previous step4) + step instructions
- Implement `buildFollowupPrompt(context, step, userAnswer)`:
  - Include user's brief answer + tone/type-specific follow-up examples
  - Reference follow-up matrix from PRD (tone √ó type √ó step)

### 4. Create AI Coaching Hook (hooks/useAICoaching.ts)
```typescript
export const useAICoaching = (step: 2 | 3 | 4) => {
  const { currentPracticeArea, currentSession, reflectionDraft, aiAvailable, aiEnabled } = useAppStore();
  const [placeholder, setPlaceholder] = useState<string | null>(null);
  const [followup, setFollowup] = useState<string | null>(null);
  const [isLoading, setIsLoading] = useState(false);

  // Build context for AI
  const buildContext = (): AIContext | null => { /* ... */ };

  // Generate placeholder on mount
  useEffect(() => {
    if (!aiAvailable || !aiEnabled || !reflectionDraft.aiAssisted) return;
    // fetch placeholder, set state, track metric
  }, [step, aiAvailable, aiEnabled]);

  // Check for follow-up when user answers
  const checkForFollowup = async (userAnswer: string) => { /* ... */ };

  return { placeholder, followup, isLoading, checkForFollowup, aiActive: aiAvailable && aiEnabled };
};
```

### 5. Update Zustand for AI State
- Add to `appStore.ts`:
  ```typescript
  aiAvailable: false,
  aiEnabled: true, // default ON for supported devices
  setAiAvailable: (available: boolean) => set({ aiAvailable: available }),
  setAiEnabled: (enabled: boolean) => set({ aiEnabled: enabled }),
  ```

### 6. Detect AI on App Launch
- In `App.tsx`:
  ```typescript
  useEffect(() => {
    const initAI = async () => {
      const aiAvailable = await checkAIAvailability();
      setAiAvailable(aiAvailable);
      if (!aiAvailable) {
        console.log('AI features unavailable - running in tones-only mode');
      }
    };
    initAI();
  }, []);
  ```

## Files Created / Modified
- **Created:**
  - `services/aiService.ts` ‚Äì AI detection, generation functions
  - `services/promptService.ts` ‚Äì system prompts, prompt builders
  - `hooks/useAICoaching.ts` ‚Äì React hook for components
- **Modified:**
  - `stores/appStore.ts` ‚Äì add aiAvailable, aiEnabled state
  - `App.tsx` ‚Äì call checkAIAvailability on launch
  - `package.json` ‚Äì add react-native-ai dependencies

## Acceptance Criteria
‚úì On iOS 26+ with Apple Intelligence, aiAvailable = true
‚úì On iOS <26 or without Apple Intelligence, aiAvailable = false
‚úì AI features hidden in UI when aiAvailable = false
‚úì generatePlaceholder returns context-aware text in <2 seconds (on supported devices)
‚úì generateFollowup returns relevant question for brief answers
‚úì Failed AI calls degrade gracefully (return null, no crash)
‚úì Console logs clear warnings for latency or errors

## Estimate
**6 hours**
",6,High
v2 Phase 3: Coaching Tone Selection Screen & Tone-Adapted Prompts,"**Goal**
Replace ReflectionFormatScreen with ReflectionToneScreen showing 3 coaching tone cards and per-session AI toggle. Update ReflectionPromptsScreen to use tone-adapted base prompts.

## Implementation Overview
- Rename ReflectionFormatScreen ‚Üí ReflectionToneScreen
- Build 3 coaching tone cards: Facilitative, Socratic, Supportive
- Add AI toggle (visible only when aiAvailable = true, default ON)
- Update ReflectionPromptsScreen to show tone-specific prompt wording
- Update Zustand actions to use coachingTone instead of format

## Implementation Steps

### 1. Rename & Rebuild ReflectionToneScreen
- Rename file: `ReflectionFormatScreen.tsx` ‚Üí `ReflectionToneScreen.tsx`
- Update navigation references
- Build UI:
  - Header: ""How would you like to reflect?""
  - 3 large tappable cards:
    - **Card 1: Facilitative ‚Äì Guided Discovery**
      - Icon: üß≠
      - Description: ""Explore your own insights through open questions""
      - Best for: ""Self-directed reflection""
    - **Card 2: Socratic ‚Äì Structured Inquiry**
      - Icon: üîç
      - Description: ""Challenge assumptions with purposeful questioning""
      - Best for: ""Deep analysis and pattern-spotting""
    - **Card 3: Supportive ‚Äì Encouraging**
      - Icon: üí™
      - Description: ""Build confidence with empathy and encouragement""
      - Best for: ""Tough sessions or low energy""
  - On tap: highlight selected card, store tone in local state
  - Show AI toggle below cards (only if aiAvailable):
    - Label: ""Enable AI coaching for this reflection""
    - Switch default ON
    - Help text:
      - ON: ""AI will suggest starter phrases and follow-up questions""
      - OFF: ""You'll see standard prompts without AI suggestions""
  - Continue button (disabled until tone selected)

### 2. Wire Tone Selection to Zustand
```typescript
const handleContinue = () => {
  setCoachingTone(selectedTone); // sets coachingTone + aiAssisted flag
  navigation.navigate('ReflectionPrompts');
};
```
- Ensure `setCoachingTone` action in Zustand:
  ```typescript
  setCoachingTone: (tone: CoachingTone) => set((state) => ({
    reflectionDraft: {
      ...state.reflectionDraft,
      coachingTone: tone,
      aiAssisted: state.aiEnabled && state.aiAvailable,
    },
  })),
  ```

### 3. Define Tone-Adapted Base Prompts
- In `utils/constants.ts` or `promptService.ts`:
```typescript
export const TONE_PROMPTS = {
  1: { // Facilitative
    step2: ""What happened during this practice? Which moments stood out to you most?"",
    step3: ""What are you noticing about yourself or your approach? Looking back, what worked and what didn't?"",
    step4: ""What do you feel ready to explore or try next time?"",
  },
  2: { // Socratic
    step2: ""What actually happened, step by step? What was different from what you expected?"",
    step3: ""What patterns are you seeing? What assumptions did you have going in?"",
    step4: ""What specific change will you test in your next session?"",
  },
  3: { // Supportive
    step2: ""What happened in this session? What parts felt most challenging or successful?"",
    step3: ""What's the main thing you're taking away from this? What felt like progress?"",
    step4: ""What's one small thing you'll focus on next time?"",
  },
};
```

### 4. Update ReflectionPromptsScreen to Use Tone Prompts
- Replace static prompts with tone-adapted prompts:
  ```typescript
  const { coachingTone } = reflectionDraft;
  const promptText = TONE_PROMPTS[coachingTone][`step${currentStep}`];
  ```
- Display dynamic prompt text based on selected tone
- Keep all other logic (autosave, character limits, navigation) unchanged for now

### 5. Update DB Queries
- Ensure queries use `coachingtone` instead of `format`:
  - Insert reflections
  - Load reflections for edit mode
  - Export queries

## Files Created / Modified
- **Renamed:**
  - `ReflectionFormatScreen.tsx` ‚Üí `ReflectionToneScreen.tsx`
- **Modified:**
  - `navigation/RootStackNavigator.tsx` ‚Äì update route name
  - `utils/constants.ts` ‚Äì add TONE_PROMPTS
  - `stores/appStore.ts` ‚Äì update setCoachingTone action
  - `screens/ReflectionPromptsScreen.tsx` ‚Äì use tone-adapted prompts
  - `db/queries.ts` ‚Äì use coachingtone field

## Acceptance Criteria
‚úì ReflectionToneScreen shows 3 coaching tone cards with descriptions
‚úì AI toggle visible only when aiAvailable = true
‚úì AI toggle defaults to ON for supported devices
‚úì Tapping tone card highlights selection
‚úì Continue button disabled until tone selected
‚úì Selected tone + AI state stored in Zustand reflectionDraft
‚úì ReflectionPromptsScreen shows tone-specific prompt wording
‚úì Prompts differ correctly between Facilitative/Socratic/Supportive
‚úì Navigation flows correctly: Tone ‚Üí Prompts ‚Üí Feedback

## Estimate
**6 hours**
",6,High
v2 Phase 4a: AI Placeholders in Reflection Prompts,"**Goal**
Integrate AI-generated placeholder starters into ReflectionPromptsScreen that appear as tappable chips or grey text when input is empty and AI is enabled.

## Implementation Overview
- Use useAICoaching hook to generate placeholders
- Display placeholders as tappable chips when field is empty
- Track aiPlaceholdersShown metric when placeholder is shown
- Allow user to tap to insert placeholder or ignore and type manually

## Implementation Steps

### 1. Integrate useAICoaching Hook
- In `ReflectionPromptsScreen.tsx`:
  ```typescript
  const { placeholder, isLoading, aiActive } = useAICoaching(currentStep);
  ```

### 2. Display Placeholder UI
- When field is empty and AI is active:
  - Option A: Show as grey placeholder text inside TextInput
  - Option B: Show as tappable chip above TextInput:
    ```tsx
    {aiActive && placeholder && !currentValue && (
      <TouchableOpacity
        style={styles.placeholderChip}
        onPress={() => setCurrentValue(placeholder)}
      >
        <Text style={styles.placeholderText}>{placeholder}</Text>
        <Text style={styles.tapToUse}>Tap to use</Text>
      </TouchableOpacity>
    )}
    ```
- Hide placeholder once user starts typing

### 3. Track Placeholder Metric
- When placeholder is displayed, increment metric:
  ```typescript
  useEffect(() => {
    if (placeholder) {
      incrementAiMetric('aiPlaceholdersShown');
    }
  }, [placeholder]);
  ```

### 4. Loading State
- Show subtle loading indicator while AI generates placeholder (< 2 sec target)
- If generation fails (returns null), show no placeholder and continue normally

### 5. Placeholder Generation Context
- Ensure useAICoaching hook builds context with:
  - Practice Area name and type
  - Session intent
  - Previous session's step4answer (from currentSession)
  - Selected coaching tone
- Pass to generatePlaceholder in aiService

## Files Created / Modified
- **Modified:**
  - `screens/ReflectionPromptsScreen.tsx` ‚Äì integrate useAICoaching, display placeholders
  - `stores/appStore.ts` ‚Äì ensure incrementAiMetric action exists
  - `hooks/useAICoaching.ts` ‚Äì finalize placeholder generation logic

## Acceptance Criteria
‚úì When AI enabled and field empty, AI placeholder appears within 2 seconds
‚úì Placeholder text is contextually relevant (references Practice Area, intent, tone)
‚úì Tapping placeholder inserts text into input field
‚úì Placeholder disappears once user starts typing
‚úì aiPlaceholdersShown metric increments when placeholder shown
‚úì Loading indicator shows while generating (subtle, non-blocking)
‚úì Failed generation degrades gracefully (no error, just no placeholder)
‚úì On devices without AI, no placeholder shows (graceful degradation)

## Estimate
**5 hours**
",5,High
v2 Phase 4b: AI Follow-up Questions in Reflection Prompts,"**Goal**
Generate adaptive AI follow-up questions when user's answer is brief (<50 chars), tailored by Practice Area type and coaching tone. Track engagement metrics.

## Implementation Overview
- Detect when user's answer is brief and AI is enabled
- Generate follow-up question using aiService
- Display follow-up with additional text input field
- Track aiFollowupsShown and aiFollowupsAnswered metrics
- Append follow-up answer to main answer

## Implementation Steps

### 1. Trigger Follow-up Generation
- In `ReflectionPromptsScreen.tsx`:
  - On blur of main TextInput, call `checkForFollowup(currentValue)` from useAICoaching hook
  - Hook checks: if answer.length < 50 && aiActive, generate follow-up

### 2. Display Follow-up UI
```tsx
{aiActive && followup && currentValue.length > 0 && currentValue.length < 50 && (
  <View style={styles.followupContainer}>
    <Text style={styles.followupLabel}>To go deeper:</Text>
    <Text style={styles.followupQuestion}>{followup}</Text>
    <TextInput
      style={styles.followupInput}
      placeholder=""Add more detail...""
      onChangeText={(text) => {
        if (text.length > 0) {
          markFollowupAnswered();
        }
        // Append to main answer
        setCurrentValue((prev) => prev + ' ' + text);
      }}
    />
  </View>
)}
```

### 3. Track Follow-up Metrics
- When follow-up is displayed:
  ```typescript
  if (result) {
    incrementAiMetric('aiFollowupsShown');
  }
  ```
- When user types in follow-up input:
  ```typescript
  const markFollowupAnswered = () => {
    if (followup) {
      incrementAiMetric('aiFollowupsAnswered');
    }
  };
  ```

### 4. Follow-up Generation Logic
- In `aiService.generateFollowup`:
  - Build prompt using tone-specific system prompt + Practice Area type modifier
  - Include user's brief answer
  - Reference follow-up matrix from PRD (tone √ó Practice Area type)
  - Generate question in <2 sec, return null if fails

### 5. Follow-up Behavior
- Max 1-2 follow-ups per step
- Follow-up disappears if user expands answer beyond 50 chars in main field
- Answering follow-up appends text to main answer (seamless integration)

## Files Created / Modified
- **Modified:**
  - `screens/ReflectionPromptsScreen.tsx` ‚Äì add follow-up UI and logic
  - `hooks/useAICoaching.ts` ‚Äì implement checkForFollowup, markFollowupAnswered
  - `services/aiService.ts` ‚Äì ensure generateFollowup uses tone/type context
  - `services/promptService.ts` ‚Äì implement follow-up prompt matrix

## Acceptance Criteria
‚úì Follow-up question appears when answer is <50 chars and AI enabled
‚úì Follow-up text is relevant to Practice Area type + coaching tone
‚úì Follow-up includes contextual question (not generic)
‚úì aiFollowupsShown metric increments when follow-up displayed
‚úì aiFollowupsAnswered metric increments when user types in follow-up field
‚úì Answering follow-up appends text to main answer
‚úì Follow-up disappears if main answer exceeds 50 chars
‚úì Max 1-2 follow-ups shown per step (not excessive)
‚úì Works correctly for all 3 tones and 4 Practice Area types

## Estimate
**5 hours**
",5,High
v2 Phase 5: Feedback Screen & Timeline Updates,"**Goal**
Update ReflectionFeedbackScreen to ask AI-aware question, and update SeriesTimelineScreen to display coaching tone badges and AI indicators.

## Implementation Overview
- Change feedback question based on aiAssisted flag
- Save AI metrics (placeholdersshown, followupsshown, followupsanswered) to DB
- Display coaching tone badges (F/S/Sup) on timeline
- Display AI indicator icon when aiassisted = 1
- Update Session Detail Modal to show coaching tone name + AI status

## Implementation Steps

### 1. Update ReflectionFeedbackScreen
- Change question text based on AI status:
  ```typescript
  const { reflectionDraft } = useAppStore();
  const question = reflectionDraft.aiAssisted
    ? ""How did the reflection coaching feel?""
    : ""How did this reflection feel?"";
  ```
- Keep emoji rating UI unchanged (0-4 scale)
- Save reflection with all new fields:
  ```typescript
  const reflection = {
    id: generateId(),
    sessionid: currentSession.id,
    coachingtone: reflectionDraft.coachingTone,
    aiassisted: reflectionDraft.aiAssisted ? 1 : 0,
    step2answer: reflectionDraft.step2,
    step3answer: reflectionDraft.step3,
    step4answer: reflectionDraft.step4,
    aiplaceholdersshown: reflectionDraft.aiPlaceholdersShown,
    aifollowupsshown: reflectionDraft.aiFollowupsShown,
    aifollowupsanswered: reflectionDraft.aiFollowupsAnswered,
    feedbackrating: reflectionDraft.feedbackRating,
    feedbacknote: reflectionDraft.feedbackNote,
    completedat: Date.now(),
    updatedat: null,
  };
  ```

### 2. Update SeriesTimelineScreen - Tone Badges
- Replace format badges with coaching tone badges:
  ```typescript
  const getToneBadge = (tone: CoachingTone) => {
    switch (tone) {
      case 1: return { abbrev: 'F', color: '#4CAF50' }; // Facilitative - green
      case 2: return { abbrev: 'S', color: '#2196F3' }; // Socratic - blue
      case 3: return { abbrev: 'Sup', color: '#FF9800' }; // Supportive - orange
    }
  };
  ```
- Render badge in session row:
  ```tsx
  <View style={[styles.toneBadge, { backgroundColor: getToneBadge(reflection.coachingtone).color }]}>
    <Text style={styles.toneBadgeText}>{getToneBadge(reflection.coachingtone).abbrev}</Text>
  </View>
  ```

### 3. Display AI Indicator
- Show small AI icon when reflection has aiassisted = 1:
  ```tsx
  {reflection.aiassisted === 1 && (
    <Text style={styles.aiIcon}>ü§ñ</Text>
  )}
  ```
- Position next to tone badge

### 4. Update Session Detail Modal
- Add to modal display:
  - **Coaching Tone:** ""Facilitative ‚Äì Guided Discovery"" (or Socratic / Supportive)
  - **AI Assisted:** ""Yes"" or ""No""
- Show below ""Reflection"" section header

### 5. Update Queries
- Ensure all timeline queries fetch new fields:
  - `coachingtone`, `aiassisted`
  - Join with reflections table
- Update Session Detail query to include AI metrics for potential future display

## Files Created / Modified
- **Modified:**
  - `screens/ReflectionFeedbackScreen.tsx` ‚Äì AI-aware question, save AI metrics
  - `screens/SeriesTimelineScreen.tsx` ‚Äì tone badges, AI indicators
  - `components/SessionDetailModal.tsx` ‚Äì show coaching tone + AI status
  - `db/queries.ts` ‚Äì ensure queries fetch new fields
  - `utils/constants.ts` ‚Äì add tone name mappings

## Acceptance Criteria
‚úì Feedback screen shows correct question based on AI status
‚úì All AI metrics saved to DB when reflection completed
‚úì Timeline shows coaching tone badges (F/S/Sup) with distinct colors
‚úì AI indicator icon shows for AI-assisted reflections
‚úì Session Detail Modal displays coaching tone name and AI status
‚úì Badges and indicators render correctly for all sessions (v1 migrated + v2 new)
‚úì No crashes when viewing sessions with/without AI assistance

## Estimate
**3 hours**
",3,High
v2 Phase 6: Export/Import Schema Updates,"**Goal**
Update JSON export schema to include Practice Area types, coaching tones, and AI metrics. Ensure import handles new v2 fields.

## Implementation Overview
- Add new fields to export JSON structure
- Add human-readable labels (coaching tone name, AI metrics)
- Update import logic to handle v2 schema
- Maintain backward compatibility with v1 exports where possible

## Implementation Steps

### 1. Update Export Schema
- In `services/exportService.ts`, update interfaces:
```typescript
interface PracticeAreaExport {
  id: string;
  name: string;
  type: PracticeAreaType; // NEW
  createdat: number;
  sessions: SessionExport[];
}

interface ReflectionExport {
  coachingtone: CoachingTone; // RENAMED from format
  coachingtonename: string; // NEW: ""Facilitative"" / ""Socratic"" / ""Supportive""
  aiassisted: boolean; // NEW
  aimetrics: { // NEW
    placeholdersshown: number;
    followupsshown: number;
    followupsanswered: number;
  };
  step2answer: string;
  step3answer: string;
  step4answer: string;
  feedbackrating: number | null;
  feedbackratinglabel: string | null; // existing
  feedbacknote: string | null;
  completedat: number;
  updatedat: number | null;
  isedited: boolean;
}
```

### 2. Build Export with New Fields
- Map coaching tone to human-readable name:
  ```typescript
  const getToneName = (tone: CoachingTone) => {
    return { 1: 'Facilitative', 2: 'Socratic', 3: 'Supportive' }[tone];
  };
  ```
- Include Practice Area type in export
- Include AI metrics in reflection export

### 3. Update Import Logic
- In `services/importService.ts`:
  - Validate incoming JSON has required v2 fields
  - Handle missing fields gracefully:
    - If `type` missing on Practice Area, default to 'solo_skill'
    - If `coachingtone` missing (old v1 export), try mapping from `format`
    - If AI fields missing, default to 0/false
  - Use atomic transactions to ensure data integrity

### 4. Import Validation
- Add schema version to export:
  ```typescript
  const exportData = {
    exportdate: new Date().toISOString(),
    appversion: '2.0',
    practiceareas: [...],
  };
  ```
- Check `appversion` on import, warn if importing v1 data into v2

### 5. Test Export/Import Roundtrip
- Export a v2 dataset with:
  - Practice Areas with all 4 types
  - Reflections with all 3 tones
  - Mix of AI-assisted and manual reflections
  - AI metrics populated
- Import back and verify all data matches

## Files Created / Modified
- **Modified:**
  - `services/exportService.ts` ‚Äì update export schema
  - `services/importService.ts` ‚Äì update import validation and insertion logic
  - `utils/types.ts` ‚Äì add export interface types

## Acceptance Criteria
‚úì Export includes Practice Area `type` field
‚úì Export includes `coachingtone` + `coachingtonename` for reflections
‚úì Export includes `aiassisted` boolean and `aimetrics` object
‚úì Export JSON is valid and parseable
‚úì Import handles v2 exports correctly (all fields restored)
‚úì Import handles v1 exports with graceful defaults
‚úì Import uses atomic transactions (no partial imports on error)
‚úì Exported/imported data matches (roundtrip test passes)

## Estimate
**2 hours**
",2,Medium
v2 Phase 7: SettingsScreen AI Status Display,"**Goal**
Add AI availability status section to SettingsScreen to inform users about AI coaching capability on their device.

## Implementation Overview
- Add new ""AI Status"" section to SettingsScreen
- Display AI availability status based on `aiAvailable` from Zustand
- Show clear messaging about device compatibility
- Position after Privacy & Security section, before Storage Management

## Implementation Steps

### 1. Add AI Status Section to SettingsScreen
- In `screens/SettingsScreen.tsx`, add new section:
  ```tsx
  <View style={styles.section}>
    <Text style={styles.sectionTitle}>AI Coaching Status</Text>
    {aiAvailable ? (
      <View style={styles.statusRow}>
        <Text style={styles.statusIcon}>‚úÖ</Text>
        <Text style={styles.statusText}>
          AI coaching available (Apple Intelligence)
        </Text>
      </View>
    ) : (
      <View style={styles.statusRow}>
        <Text style={styles.statusIcon}>‚ÑπÔ∏è</Text>
        <Text style={styles.statusText}>
          AI coaching unavailable on this device. Coaching tones still work without AI.
        </Text>
      </View>
    )}
    <Text style={styles.helpText}>
      AI coaching runs entirely on your device. Your reflections are never sent to any server.
    </Text>
  </View>
  ```

### 2. Access AI State from Zustand
- Import `aiAvailable` from `useAppStore`:
  ```typescript
  const { aiAvailable } = useAppStore();
  ```

### 3. Style AI Status Section
- Match existing section styling (Privacy & Security, Storage Management)
- Use consistent spacing and typography
- Status icon + text in a row
- Help text below in smaller, muted color

### 4. Update Section Order
- Reorder sections:
  1. Export Data
  2. Privacy & Security
  3. **AI Coaching Status** (NEW)
  4. Storage Management
  5. About

## Files Created / Modified
- **Modified:**
  - `screens/SettingsScreen.tsx` ‚Äì add AI Status section

## Acceptance Criteria
‚úì AI Status section displays in SettingsScreen
‚úì Shows ‚úÖ ""AI coaching available"" when aiAvailable = true
‚úì Shows ‚ÑπÔ∏è ""AI coaching unavailable"" when aiAvailable = false
‚úì Help text explains on-device processing and privacy
‚úì Section styling matches other Settings sections
‚úì No crashes when aiAvailable state changes

## Estimate
**1 hour**
",1,Medium
